# Multiprocess Aiohttp Load Tester

Небольшой скрипт для нагрузочного тестирования HTTP-сервиса с помощью **multiprocessing** и **asyncio + aiohttp**.  
Скрипт отправляет POST-запросы на заданный URL, плавно увеличивая частоту запросов за заданный промежуток времени и собирая статистику по ответам.

## Возможности

- Запуск нескольких воркеров в отдельных процессах.
- В каждом процессе — асинхронный клиент на базе `aiohttp`.
- Плавное изменение частоты запросов (от `start_freq` до `end_freq` запросов в секунду).
- Сбор метрик:
  - код ответа или ошибка;
  - задержка (latency);
  - время запроса и ответа;
  - текст ответа.
- Вывод агрегированной статистики по статусам и количеству ответов.

## Структура репозитория

```text
.
├── test_multiproc_aiohttp.py  # основной скрипт нагрузочного теста
└── body_data.json             # тело POST-запроса
````

> Файл `body_data.json` должен находиться в той же директории, что и скрипт.

## Требования

* Python 3.9+
* Установленные библиотеки:

```bash
pip install aiohttp numpy
```

(модули `multiprocessing`, `threading`, `time`, `datetime`, `json`, `asyncio` входят в стандартную библиотеку Python).

## Основные параметры

Внутри `test_multiproc_aiohttp.py` можно настроить:

```python
url = r"http://localhost:8000/add_name"  # целевой URL

duration = 60        # длительность теста в секундах
start_freq = 50      # стартовая частота запросов (запросов в секунду)
end_freq = 500       # конечная частота запросов (запросов в секунду)
num_processes = 6    # количество процессов-воркеров

output_file = 'test_results.json'  # имя файла для результатов (переменная пока не используется)
```

* Частота запросов линейно меняется от `start_freq` до `end_freq` за `duration` секунд.
* Нагрузка распределяется между `num_processes` процессов.
* Тело запроса берётся из файла `body_data.json`.

## Подготовка `body_data.json`

Создайте файл `body_data.json` рядом со скриптом.
Внутри должен быть валидный JSON-объект, который ваш сервер ожидает в теле POST-запроса. Пример:

```json
{
  "name": "test",
  "value": 123
}
```

Скрипт прочитает этот файл и отправит его как JSON в каждый запрос.

## Запуск

1. Убедитесь, что целевой сервер запущен и доступен по адресу, указанному в `url`.

2. Установите зависимости:

   ```bash
   pip install aiohttp numpy
   ```

3. Запустите скрипт:

   ```bash
   python test_multiproc_aiohttp.py
   ```

В консоли вы увидите:

* текущее время и время с начала теста;
* количество отправленных запросов;
* количество полученных ответов;
* итоговую статистику по кодам статусов и примеры первых/последних ответов.

## Дальнейшее развитие

* Сохранение всех результатов в `test_results.json` вместо простого вывода в консоль.
* Добавление аргументов командной строки (`argparse`) для настройки параметров без изменения кода.
* Поддержка разных HTTP-методов и нескольких URL/сценариев нагрузки.

```
